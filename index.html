<html>
    <head>
        <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
        <script src="components/creeper.js"></script>
        <script src="components/game.js"></script>
        <script src="components/player.js"></script>
        <script src="https://rawgit.com/mayognaise/aframe-mouse-cursor-component/master/dist/aframe-mouse-cursor-component.min.js"></script>
        <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.0.1/dist/aframe-extras.min.js"></script>
        <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
        <script src="https://unpkg.com/aframe-physics-system@1.4.0/dist/aframe-physics-system.min.js"></script>
        <script src="https://unpkg.com/aframe-fps-counter-component/dist/aframe-fps-counter-component.min.js"></script>
        <script src="https://unpkg.com/aframe-particle-system-component@1.0.x/dist/aframe-particle-system-component.min.js"></script>
        <script src="node_modules/aframe-extras.ocean/dist/aframe-extras.ocean.min.js"></script>
    </head>
    <body id="wrapper">
        <div style="position:relative;">
            <a-scene click-handler id="scene"
                     light="defaultLightsEnabled: false"
                     physics="debug: true; gravity: -100">
                <a-assets>
                    <a-asset-item id="creepers" src="./assets/images/creepers/scene.gltf"
                                  animation-mixer></a-asset-item>
                    <a-asset-item id="ship_model" src="./assets/images/ship/scene.gltf"></a-asset-item>
                    <img id="stone" src="./assets/images/stone.png">
                    <img id="glowstone" src="./assets/images/glowstone.jpg">
                    <img id="diorite" src="./assets/images/diorite.png">
                    <img id="coal_ore" src="./assets/images/coal_ore.png">
                    <img id="lava" src="./assets/images/lava.jpg">
                    <img id="cobblestone" src="./assets/images/cobblestone.jpg">
                    <img id="osidian" src="./assets/images/osidian.png">
                    <img id="iron_ore" src="./assets/images/iron_ore.png">
                    <img id="planks" src="./assets/images/planks.png">
                    <img id="gold_ore" src="./assets/images/gold_ore.png">
                    <img id="gravel" src="./assets//images/gravel.png">
                    <img id="craftingtable" src="./assets/images/craftingtable.png">
                    <img id="rail" src="./assets/images/rail.png">
                    <img id="diamond" src="./assets/images/diamond.png">
                    <img id="grass" src="./assets/images/grass.png">
                    <img id="log" src="./assets/images/log.png">
                    <img id="leaves" src="./assets/images/leaves.png">
                </a-assets>

                <!--Camera -->
                <a-entity id="cameraWrapper" geometry="box" dynamic-body="mass:100" position="0 1 0" width="2"
                          height="2"
                          depth="2" listener>
                    <a-camera animation="property: rotation; to: 0 0 0" wasd-controls-enabled="false"
                              foo jump-ability
                              kinematic-body="radius:0.4"
                              id="player"
                              physics-body="boundingBox: 0.1 0.1 0.1; mass: 1; velocity: 0.2 0 0"
                              position="0 1 0"
                    >
                        <a-entity id="overlay" radius="2" material="opacity:0.4; color: black; side: back"></a-entity>
                        <a-light type="point" intensity="1.5" decay="1" distance="7" color="#FFC"></a-light>
<!--                        <a-sound src="src: url(./assets/sounds/minecraftbgmusic.mp3)" autoplay="true"-->
                        <!--                                 position="0 0 0"></a-sound>-->
                        <a-cursor></a-cursor>
                    </a-camera>
                </a-entity>

                <!--Creeper entity -->

                <a-entity animation="to: 0 0 50; property: position;  dur: 2000; easing: linear" rotation="0 180 0"
                          animation-mixer="clip: ArmatureAction.001" dur="300" easing="linear"
                          kinematic-body id="creeper" position="0 0 0" scale="1.2 1.2 1.2"
                          gltf-model="#creepers"></a-entity>
                <a-entity>

                <a-box static-body material="src: #stone" width="6" height="6" depth="6" repeat="5 5"
                        position="-0.5 -2.5 0.5" rotation="90 0 0"></a-box>
                <a-box static-body material="src: #stone" width="5" depth="5" repeat="5 5" position="3 3 0"
                        rotation="90 0 90"></a-box>
                <a-box static-body material="src: #stone" width="5" height="5" depth="5" repeat="5 5"
                        position="-5 3 0" rotation="90 0 90"></a-box>
                <a-box static-body material="src: #stone" width="5" depth="5" repeat="5 5" position="0 6 0"></a-box>
                <a-box static-body material="src: #stone" width="5" depth="5" repeat="5 5" position="0 3 3"
                        rotation="90 0 0"></a-box>

                <a-entity id="first-stage">

                </a-entity>

                <!-- drop -->
                <a-box static-body material="src: #stone" width="10" height="10" repeat="4 4"
                        position="3.5 -6.5 -19"></a-box>
                <a-box static-body material="src: #stone" width="10" height="10" repeat="4 4"
                        position="-7.5 -6.5 -19"></a-box>
                <a-box static-body material="src: #stone" width="1" height="2" repeat="1 2"
                        position="-2 -2.5 -20"></a-box>
                <a-box static-body material="src: #stone" width="1" height="10" repeat="1 10"
                        position="-2 -7.5 -18"></a-box>
                <a-box static-body material="src: #stone" id="end-stage-one" width="1" height="11" repeat="1 10"
                        position="-2 -10.5 -19"></a-box>
                <a-box static-body material="src: #stone" width="3" height="12" depth="2" repeat="3 10"
                        position="-2 -8 -21.5"></a-box>
                <a-box static-body material="src: #stone" width="1" height="9" repeat="1 10"
                        position="-1 -7 -20"></a-box>
                <a-box static-body material="src: #stone" width="1" height="9" repeat="1 10"
                        position="-3 -7 -20"></a-box>
                <a-box id="second-stage-floor" static-body material="src: #stone" width="20" height="20" depth="20"
                        repeat="20 20" position="-3 -26 -27.5"></a-box>

                <a-entity id="second-stage">

                </a-entity>
                
                <a-entity id="third-stage">
       
                </a-entity>

                <a-sky color="#12e3e3"></a-sky>
                    
            </a-scene>
            <div style="position:absolute; top:0px; left:0px; z-index:1000;">
                <img id="dead" src="assets/images/dead.png"
                     style="cursor:pointer;margin-top :-15px;display: none;width: 100vw;transform: rotateX(15deg)">
            </div>
        </div>
    </body>
    <script>

        function cos(v) {
            return Math.cos((v - 180) * (Math.PI / 180.0));
        }

        function sin(v) {
            return Math.sin((v - 180) * (Math.PI / 180.0));
        }


        function tan(v) {
            return Math.tan((v - 180) * (Math.PI / 180.0));
        }

        let moving = false;
        let debug = false;

        function movePlayer() {
            moving = true;
        }

        document.querySelector("#wrapper").addEventListener('mousedown', movePlayer);
        document.querySelector("#wrapper").addEventListener('mouseup', stopPlayer);

        function stopPlayer() {
            moving = false;
        }

        AFRAME.registerComponent("foo", {
            init: function () {
            },
            tick() {
                if (moving === true) {
                    const step = 0.05
                    const player = document.querySelector("a-camera")
                    let r = player.getAttribute('rotation');
                    var pos = player.getAttribute("position");
                    pos.x += step * sin(r.y);
                    pos.y += step * tan(r.x);
                    pos.z += step * cos(r.y);
                    player.setAttribute("position", pos);
                }
            }
        })
    </script>

</html>
